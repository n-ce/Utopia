<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#000000">
    <title>PHIfold: Genesis POC</title>
    <style>
        :root {
            --phi: 1.61803398875;
            --threshold: 5.083203;
        }

        * {
            box-sizing: border-box;
            touch-action: none;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: #000;
            color: #fff;
            font-family: 'Courier New', Courier, monospace;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100dvh;
            width: 100dvw;
            overflow: hidden;
        }

        /* 1:1 Responsive Container using dvmin */
        #void-bed {
            position: relative;
            width: 90dvmin;
            height: 90dvmin;
            background: radial-gradient(circle at center, #080808 0%, #000 85%);
            display: flex;
            justify-content: center;
            align-items: center;
            /* Visualizing the "trampoline" curvature subtly */
            border-radius: 50%;
            box-shadow: inset 0 0 10dvmin #000;
        }

        #vessel {
            position: absolute;
            width: 12dvmin;
            height: 18dvmin;
            border: 1px dashed rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            z-index: 5;
            transition: all 1s cubic-bezier(0.19, 1, 0.22, 1);
        }

        #vessel.stabilized {
            border: 1px solid #fff;
            box-shadow: 0 0 4dvmin #fff;
            background: rgba(255,255,255,0.05);
        }

        .spark {
            position: absolute;
            background: #fff;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 1.5dvmin #fff;
            will-change: transform, opacity;
            /* Anti-particle jitter */
            animation: jitter 0.1s infinite alternate;
        }

        @keyframes jitter {
            from { transform: translate(-0.15dvmin, -0.15dvmin); }
            to { transform: translate(0.15dvmin, 0.15dvmin); }
        }

        #ui {
            position: absolute;
            bottom: 8dvh;
            display: flex;
            flex-direction: column;
            align-items: center;
            pointer-events: none;
        }

        #progress-frame {
            width: 40dvmin;
            height: 1px;
            background: #111;
            margin-bottom: 3dvh;
        }

        #progress-fill {
            width: 0%;
            height: 100%;
            background: #fff;
            box-shadow: 0 0 2dvmin #fff;
            transition: width 0.3s ease-out;
        }

        #manifest-btn {
            pointer-events: auto;
            background: #fff;
            color: #000;
            border: none;
            padding: 1.5dvh 4dvmin;
            font-size: 1.8dvmin;
            font-weight: bold;
            letter-spacing: 0.8dvmin;
            cursor: pointer;
            display: none;
            text-transform: uppercase;
        }

        #stats {
            font-size: 1dvmin;
            color: #333;
            margin-top: 2dvh;
            letter-spacing: 0.2dvmin;
        }
    </style>
</head>
<body>

    <div id="void-bed">
        <div id="vessel"></div>
    </div>

    <div id="ui">
        <div id="progress-frame">
            <div id="progress-fill"></div>
        </div>
        <button id="manifest-btn" onclick="manifest()">Manifest</button>
        <div id="stats">Ω: <span id="e-val">0.000</span> | ρ: <span id="d-val">0.000</span></div>
    </div>

    <script>
        const PHI = (1 + Math.sqrt(5)) / 2;
        const TARGET = Math.PI * PHI;
        let energy = 0;

        const voidBed = document.getElementById('void-bed');
        const vessel = document.getElementById('vessel');
        const progressFill = document.getElementById('progress-fill');
        const manifestBtn = document.getElementById('manifest-btn');

        // Logic Loop
        function tick() {
            const sparks = document.querySelectorAll('.spark');
            let density = 0;
            sparks.forEach(s => {
                density += parseFloat(s.dataset.mass);
                
                // Trampoline Gravity: Move relative coordinates toward 50% center
                let x = parseFloat(s.dataset.x);
                let y = parseFloat(s.dataset.y);
                x += (50 - x) * 0.003;
                y += (50 - y) * 0.003;
                s.dataset.x = x;
                s.dataset.y = y;
                s.style.left = x + '%';
                s.style.top = y + '%';
            });

            document.getElementById('d-val').innerText = density.toFixed(3);

            if (energy > 0) {
                // Dynamic Entropy scaling with Density
                const alpha = 1.618 + (density / Math.PI);
                const beta = 0.003 * (1 + density);
                energy = Math.max(0, energy - (Math.pow(energy, alpha) * beta));
            }

            // Update UI
            const p = (energy / TARGET) * 100;
            progressFill.style.width = Math.min(100, p) + '%';
            document.getElementById('e-val').innerText = energy.toFixed(4);

            if (energy >= TARGET) {
                manifestBtn.style.display = 'block';
                vessel.classList.add('stabilized');
            } else {
                manifestBtn.style.display = 'none';
                vessel.classList.remove('stabilized');
            }

            requestAnimationFrame(tick);
        }

        function createSpark() {
            const s = document.createElement('div');
            const mass = Math.random() * PHI;
            const lifespan = 2000 + (Math.random() * 2000);
            const birth = Date.now();
            
            const x = Math.random() * 100;
            const y = Math.random() * 100;

            s.className = 'spark';
            s.dataset.mass = mass;
            s.dataset.x = x;
            s.dataset.y = y;
            s.style.left = x + '%';
            s.style.top = y + '%';

            voidBed.appendChild(s);

            const decay = setInterval(() => {
                const age = Date.now() - birth;
                const currentMass = mass * Math.pow(0.5, age / lifespan);
                s.dataset.mass = currentMass;

                // Relative size using dvmin
                const size = 0.5 + (currentMass * 1.5);
                s.style.width = size + 'dvmin';
                s.style.height = size + 'dvmin';
                s.style.opacity = currentMass / PHI;

                if (currentMass < 0.01) {
                    clearInterval(decay);
                    if (s.parentNode) voidBed.removeChild(s);
                }
            }, 50);

            s.onpointerdown = (e) => {
                energy += parseFloat(s.dataset.mass);
                clearInterval(decay);
                voidBed.removeChild(s);
            };
        }

        function manifest() {
            voidBed.style.transform = 'scale(0) rotate(720deg)';
            voidBed.style.opacity = '0';
            setTimeout(() => {
                alert("STABILIZATION SUCCESSFUL\nAnti-matter converted to Base Card #001");
                location.reload();
            }, 1000);
        }

        // Spawn logic
        (function spawner() {
            setTimeout(() => {
                createSpark();
                spawner();
            }, 400 + Math.random() * 1200);
        })();

        requestAnimationFrame(tick);
    </script>
</body>
</html>
