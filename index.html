<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#000000">
    <title>PHIfold: Genesis</title>
    <style>
        :root {
            --phi: 1.61803398875;
        }

        * {
            box-sizing: border-box;
            touch-action: none;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: #000;
            color: #fff;
            font-family: 'Courier New', Courier, monospace;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100dvh;
            width: 100dvw;
            overflow: hidden;
        }

        /* Responsive 1:1 Void Bed */
        #void-bed {
            position: relative;
            width: 100dvw;
            height: 100dvw;
            max-width: 100dvh;
            max-height: 100dvh;
            background: radial-gradient(circle at center, #080808 0%, #000 85%);
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 50%;
            box-shadow: inset 0 0 10dvmin #000;
            transition: transform 1.5s cubic-bezier(0.19, 1, 0.22, 1), opacity 1s;
        }

        #vessel {
            position: absolute;
            width: 12dvmin;
            height: 18dvmin;
            border: 1px dashed rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            z-index: 5;
            transition: all 0.5s ease;
        }

        #vessel.stabilized {
            border: 1px solid #fff;
            box-shadow: 0 0 4dvmin #fff;
            background: rgba(255,255,255,0.05);
        }

        .spark {
            position: absolute;
            background: #fff;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 1.5dvmin #fff;
            will-change: transform;
            /* The Hitbox Fix: Large transparent border increases touch area */
            border: 20px solid transparent;
            background-clip: padding-box;
        }

        /* Intro Overlay */
        #intro {
            position: fixed;
            inset: 0;
            background: #000;
            z-index: 100;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 40px;
        }

        #intro h1 { letter-spacing: 0.8dvmin; font-size: 6dvmin; margin-bottom: 10px; }
        #intro p { color: #666; font-size: 2dvmin; max-width: 400px; line-height: 1.6; margin-bottom: 30px; }
        #intro button {
            background: none; border: 1px solid #fff; color: #fff;
            padding: 15px 40px; cursor: pointer; font-family: inherit;
            letter-spacing: 0.2em; transition: all 0.3s;
        }
        #intro button:active { background: #fff; color: #000; }

        /* Inventory (Bottom Left) */
        #inventory {
            position: absolute;
            bottom: 30px;
            left: 30px;
            z-index: 20;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .card-slot {
            width: 50px;
            height: 75px;
            border: 1px dashed #222;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            color: #222;
            transition: all 0.8s ease;
        }

        #ui {
            position: absolute;
            bottom: 8dvh;
            display: flex;
            flex-direction: column;
            align-items: center;
            pointer-events: none;
        }

        #progress-frame { width: 40dvmin; height: 1px; background: #111; margin-bottom: 3dvh; }
        #progress-fill { width: 0%; height: 100%; background: #fff; box-shadow: 0 0 2dvmin #fff; transition: width 0.3s; }

        #manifest-btn {
            pointer-events: auto; background: #fff; color: #000; border: none;
            padding: 1.5dvh 4dvmin; font-size: 1.8dvmin; font-weight: bold;
            letter-spacing: 0.8dvmin; cursor: pointer; display: none;
        }

        #stats { font-size: 1.2dvmin; color: #444; margin-top: 2dvh; }
    </style>
</head>
<body>

    <div id="intro">
        <h1>PHIFOLD</h1>
        <p>THE VOID IS UNSTABLE.<br>COLLECT SPARKS TO REACH THE CRITICAL THRESHOLD OF $\pi \times \phi$.</p>
        <button onclick="startGame()">INITIATE GENESIS</button>
    </div>

    <div id="void-bed">
        <div id="vessel"></div>
    </div>

    <div id="inventory">
        <div id="card-001" class="card-slot">VOID</div>
    </div>

    <div id="ui">
        <div id="progress-frame"><div id="progress-fill"></div></div>
        <button id="manifest-btn" onclick="manifest()">MANIFEST</button>
        <div id="stats">Ω: <span id="e-val">0.000</span> | ρ: <span id="d-val">0.000</span></div>
    </div>

    <script>
        const PHI = (1 + Math.sqrt(5)) / 2;
        const TARGET = Math.PI * PHI;
        let energy = 0;
        let isRunning = false;

        const voidBed = document.getElementById('void-bed');
        const vessel = document.getElementById('vessel');
        const progressFill = document.getElementById('progress-fill');
        const manifestBtn = document.getElementById('manifest-btn');

        function startGame() {
            document.getElementById('intro').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('intro').style.display = 'none';
                isRunning = true;
                spawner();
                requestAnimationFrame(tick);
            }, 500);
        }

        function tick() {
            if (!isRunning) return;

            const sparks = document.querySelectorAll('.spark');
            let density = 0;
            
            sparks.forEach(s => {
                density += parseFloat(s.dataset.mass);
                let x = parseFloat(s.dataset.x);
                let y = parseFloat(s.dataset.y);
                
                // Gravity pull toward center (50, 50)
                x += (50 - x) * 0.004;
                y += (50 - y) * 0.004;
                
                s.dataset.x = x;
                s.dataset.y = y;
                s.style.transform = `translate(-50%, -50%) translate3d(${x}%, ${y}%, 0)`;
            });

            document.getElementById('d-val').innerText = density.toFixed(3);

            if (energy > 0) {
                const alpha = 1.618 + (density / Math.PI);
                const beta = 0.003 * (1 + density);
                energy = Math.max(0, energy - (Math.pow(energy, alpha) * beta));
            }

            const p = (energy / TARGET) * 100;
            progressFill.style.width = Math.min(100, p) + '%';
            document.getElementById('e-val').innerText = energy.toFixed(4);

            if (energy >= TARGET) {
                manifestBtn.style.display = 'block';
                vessel.classList.add('stabilized');
            } else {
                manifestBtn.style.display = 'none';
                vessel.classList.remove('stabilized');
            }

            requestAnimationFrame(tick);
        }

        function createSpark() {
            const s = document.createElement('div');
            const mass = Math.random() * PHI;
            const lifespan = 3000 + (Math.random() * 2000);
            const birth = Date.now();
            
            // Spawn in a circle to ensure they start on-screen
            const angle = Math.random() * Math.PI * 2;
            const radius = 30 + (Math.random() * 15); 
            const x = 50 + radius * Math.cos(angle);
            const y = 50 + radius * Math.sin(angle);

            s.className = 'spark';
            s.dataset.mass = mass;
            s.dataset.x = x;
            s.dataset.y = y;
            s.style.left = '0%'; 
            s.style.top = '0%';

            voidBed.appendChild(s);

            const decay = setInterval(() => {
                const age = Date.now() - birth;
                const currentMass = mass * Math.pow(0.5, age / lifespan);
                s.dataset.mass = currentMass;

                const size = 0.8 + (currentMass * 1.5);
                s.style.width = size + 'dvmin';
                s.style.height = size + 'dvmin';
                s.style.opacity = currentMass / PHI;

                if (currentMass < 0.05) {
                    clearInterval(decay);
                    if (s.parentNode) voidBed.removeChild(s);
                }
            }, 50);

            s.onpointerdown = (e) => {
                e.stopPropagation();
                energy += parseFloat(s.dataset.mass);
                clearInterval(decay);
                s.remove();
            };
        }

        function spawner() {
            if (!isRunning) return;
            createSpark();
            setTimeout(spawner, 600 + Math.random() * 1000);
        }

        function manifest() {
            isRunning = false;
            voidBed.style.transform = 'scale(0) rotate(1080deg)';
            voidBed.style.opacity = '0';
            
            const card = document.getElementById('card-001');
            setTimeout(() => {
                card.style.border = "1px solid #fff";
                card.style.boxShadow = "0 0 15px #fff";
                card.style.color = "#fff";
                card.innerText = "#001";
                alert("STABILIZATION SUCCESSFUL\nAnti-matter condensed into Base Card #001");
            }, 1000);
        }
    </script>
</body>
</html>
